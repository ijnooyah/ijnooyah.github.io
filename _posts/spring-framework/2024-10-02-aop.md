---
title: "[Spring Framework] AOP"
excerpt: ""

categories:
  - Spring Framework
tags:
  - [Spring Framework]

permalink: /spring-framework/aop

toc: true
toc_sticky: true

date: 2024-10-02
last_modified_at: 2024-10-02
---

# π§© AOPλ€ λ¬΄μ—‡μΈκ°€?

AOP(Aspect-Oriented Programming)λ” κ°μ²΄ μ§€ν–¥ ν”„λ΅κ·Έλλ°μ ν•κ³„λ¥Ό λ³΄μ™„ν•λ” ν”„λ΅κ·Έλλ° ν¨λ¬λ‹¤μ„μ΄λ‹¤. AOPλ” μ• ν”λ¦¬μΌ€μ΄μ… μ „λ°μ— κ±Έμ³ μ¤‘λ³µμ μΌλ΅ μ‚¬μ©λλ” **κ³µν†µ κ΄€μ‹¬μ‚¬(cross-cutting concerns)**λ¥Ό λ¨λ“ν™”ν•μ—¬ μ½”λ“μ μ¬μ‚¬μ©μ„±κ³Ό μ μ§€λ³΄μμ„±μ„ λ†’μ΄λ” λ° μ¤‘μ μ„ λ‘”λ‹¤. κ³µν†µ κ΄€μ‹¬μ‚¬μ μμ‹μ—λ” λ΅κΉ…, νΈλμ­μ… κ΄€λ¦¬, λ³΄μ•, μΊμ‹±, μ¤λ¥ μ²λ¦¬ λ“±μ΄ μλ‹¤.

---

# π”‘ AOPμ μ£Όμ” κ°λ…

## π― ν¬μΈνΈμ»· (Pointcut)

**ν¬μΈνΈμ»·(Pointcut)**μ€ [μ–΄λ“λ°”μ΄μ¤](#-μ–΄λ“λ°”μ΄μ¤-advice)λ¥Ό μ μ©ν•  μ΅°μΈ ν¬μΈνΈ(Join Point)λ¥Ό μ„ νƒν•λ” ν‘ν„μ‹μ΄λ‹¤. μ΅°μΈ ν¬μΈνΈλ” λ©”μ„λ“ μ‹¤ν–‰, κ°μ²΄ μƒμ„±, ν•„λ“ μ ‘κ·Ό λ“± λ‹¤μ–‘ν• μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰ μ§€μ μ„ λ‚νƒ€λ‚Έλ‹¤.

**μμ‹:**
```java
@Pointcut("execution(* com.example.service.*.*(..))")
public void serviceLayer() {}
```

μ΄ ν¬μΈνΈμ»·μ€ `com.example.service` ν¨ν‚¤μ§€μ λ¨λ“  ν΄λμ¤μ λ¨λ“  λ©”μ„λ“λ¥Ό λ€μƒμΌλ΅ μ§€μ •ν•λ‹¤.

### π“ ν¬μΈνΈμ»· ν‘ν„μ‹

- `execution()`: λ©”μ„λ“ μ‹¤ν–‰ μ΅°μΈ ν¬μΈνΈλ¥Ό λ§¤μΉ­
- `within()`: νΉμ • νƒ€μ… λ‚΄μ μ΅°μΈ ν¬μΈνΈλ¥Ό λ§¤μΉ­
- `this()`: ν”„λ΅μ‹ κ°μ²΄λ¥Ό λ€μƒμΌλ΅ ν•λ” μ΅°μΈ ν¬μΈνΈλ¥Ό λ§¤μΉ­
- `target()`: λ€μƒ κ°μ²΄λ¥Ό λ€μƒμΌλ΅ ν•λ” μ΅°μΈ ν¬μΈνΈλ¥Ό λ§¤μΉ­
- `args()`: λ©”μ„λ“μ μΈμλ¥Ό λ€μƒμΌλ΅ ν•λ” μ΅°μΈ ν¬μΈνΈλ¥Ό λ§¤μΉ­

---

## π’΅ μ–΄λ“λ°”μ΄μ¤ (Advice)

**μ–΄λ“λ°”μ΄μ¤(Advice)**λ” AOPμ—μ„ "λ¬΄μ—‡μ„" ν•  κ²ƒμΈμ§€λ¥Ό μ •μν•λ” λ¶€λ¶„μ΄λ‹¤. μ¦‰, ν΅λ‹¨ κ΄€μ‹¬μ‚¬(cross-cutting concern)μ κµ¬ν„μ²΄λΌκ³  ν•  μ μλ‹¤. μ–΄λ“λ°”μ΄μ¤λ” νΉμ • μ΅°μΈ ν¬μΈνΈμ—μ„ μ‹¤ν–‰λ  μ‹¤μ  λ΅μ§μ„ ν¬ν•¨ν•κ³  μλ‹¤. 

---
{: .style1}

### π“ μ–΄λ“λ°”μ΄μ¤ μ ν•
#### β®οΈ Before

- μ΅°μΈ ν¬μΈνΈ μ‹¤ν–‰ μ „μ— μ‹¤ν–‰λλ‹¤.
- μ: λ©”μ†λ“ μ‹¤ν–‰ μ „ λ΅κΉ…, νλΌλ―Έν„° μ ν¨μ„± κ²€μ‚¬
```java
@Before("execution(* com.example.service.*.*(..))")
public void logBefore(JoinPoint joinPoint) {
    System.out.println("Before method: " + joinPoint.getSignature().getName());
}
```

---
{: .style1}

#### β­οΈ After

- μ΅°μΈ ν¬μΈνΈ μ‹¤ν–‰ ν›„ ν•­μƒ μ‹¤ν–‰λλ‹¤.(μ •μƒ μΆ…λ£, μμ™Έ λ°μƒ λ¨λ‘ ν¬ν•¨)
- μ: λ¦¬μ†μ¤ μ •λ¦¬, ν†µκ³„ μ—…λ°μ΄νΈ
```java
@After("execution(* com.example.service.*.*(..))")
public void logAfter(JoinPoint joinPoint) {
    System.out.println("After method: " + joinPoint.getSignature().getName());
}
```

---
{: .style1}

#### β… AfterReturning

- μ΅°μΈ ν¬μΈνΈκ°€ μ •μƒμ μΌλ΅ μΆ…λ£λ ν›„ μ‹¤ν–‰λλ‹¤.
- μ: λ°ν™κ°’ λ΅κΉ…, μ¶”κ°€ κ²°κ³Ό μ²λ¦¬
```java
@AfterReturning(pointcut = "execution(* com.example.service.*.*(..))", returning = "result")
public void logAfterReturning(JoinPoint joinPoint, Object result) {
    System.out.println("Method returned: " + result);
}
```

---
{: .style1}

#### β AfterThrowing 

- μ΅°μΈ ν¬μΈνΈμ—μ„ μμ™Έκ°€ λ°μƒν–μ„ λ• μ‹¤ν–‰λλ‹¤.
- μ: μμ™Έ λ΅κΉ…, μ¶”κ°€μ μΈ μμ™Έ μ²λ¦¬
```java
@AfterThrowing(pointcut = "execution(* com.example.service.*.*(..))", throwing = "error")
public void logAfterThrowing(JoinPoint joinPoint, Throwable error) {
    System.out.println("Exception in " + joinPoint.getSignature().getName() + ": " + error);
}
```

---
{: .style1}

#### π”„ Around

- κ°€μ¥ κ°•λ ¥ν• μ–΄λ“λ°”μ΄μ¤λ΅, μ΅°μΈ ν¬μΈνΈ μ‹¤ν–‰ μ „ν›„μ— λ΅μ§μ„ μ‹¤ν–‰ν•  μ μλ‹¤.
- μ΅°μΈ ν¬μΈνΈ μ‹¤ν–‰ μ—¬λ¶€λ¥Ό μ§μ ‘ μ μ–΄ν•  μ μλ‹¤.
- μ: λ©”μ†λ“ μ‹¤ν–‰ μ‹κ°„ μΈ΅μ •, νΈλμ­μ… κ΄€λ¦¬ 
```java
@Around("execution(* com.example.service.*.*(..))")
public Object logAround(ProceedingJoinPoint joinPoint) throws Throwable {
    long start = System.currentTimeMillis();
    
    Object result = joinPoint.proceed(); // μ‹¤μ  λ©”μ†λ“ μ‹¤ν–‰
    
    long executionTime = System.currentTimeMillis() - start;
    System.out.println(joinPoint.getSignature() + " executed in " + executionTime + "ms");
    
    return result;
}
```

---

## π”— μ–΄λ“λ°”μ΄μ € (Advisor)

**μ–΄λ“λ°”μ΄μ €(Advisor)**λ” **ν¬μΈνΈμ»·**κ³Ό **μ–΄λ“λ°”μ΄μ¤**λ¥Ό κ²°ν•©ν•μ—¬ νΉμ • μƒν™©μ—μ„ νΉμ • λ™μ‘μ„ μν–‰ν•λ„λ΅ ν•λ‹¤. Spring AOPμ—μ„λ” `@Aspect` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•΄ μ–΄λ“λ°”μ΄μ €λ¥Ό μ •μν•λ‹¤.

μμ‹:
```java
@Aspect
@Component
public class LoggingAspect {
    @Before("execution(* com.example.service.*.*(..))")
    public void logMethodEntry(JoinPoint joinPoint) {
        String methodName = joinPoint.getSignature().getName();
        System.out.println("Entering method: " + methodName);
    }
}
```

---

# π’» μ‹¤μ  μ‚¬μ© μμ‹

νΈλμ­μ… κ΄€λ¦¬λ¥Ό AOPλ΅ κµ¬ν„ν• μμ‹:

```java
@Aspect
@Component
public class TransactionAspect {
    
    @Autowired
    private PlatformTransactionManager transactionManager;
    
    @Around("@annotation(Transactional)")
    public Object manageTransaction(ProceedingJoinPoint joinPoint) throws Throwable {
        TransactionStatus status = transactionManager.getTransaction(new DefaultTransactionDefinition());
        try {
            Object result = joinPoint.proceed();
            transactionManager.commit(status);
            return result;
        } catch (Exception e) {
            transactionManager.rollback(status);
            throw e;
        }
    }
}
```

μ΄ μμ‹μ—μ„λ” `@Transactional` μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ€ λ©”μ„λ“μ— λ€ν•΄ νΈλμ­μ…μ„ μλ™μΌλ΅ κ΄€λ¦¬ν•λ‹¤.



